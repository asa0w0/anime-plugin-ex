<div class="anime-detail-container">
    <div class="anime-detail-header">
        <div class="anime-detail-image">
            <img src={{this.model.images.jpg.large_image_url}} alt={{this.model.title}} />
        </div>
        <div class="anime-detail-info">
            <h1>{{this.model.title}}</h1>
            <div class="anime-rating">
                <span class="label">Score:</span>
                <span class="value">{{this.model.score}}</span>
            </div>
            <div class="anime-meta">
                <p><strong>Status:</strong> {{this.model.status}}</p>
                <p><strong>Episodes:</strong> {{this.model.episodes}}</p>
                <p><strong>Aired:</strong> {{this.model.aired.string}}</p>
            </div>
            <div class="anime-genres">
                {{#each this.model.genres as |genre|}}
                <span class="genre-tag">{{genre.name}}</span>
                {{/each}}
            </div>

            {{#if this.currentUser}}
            <div class="anime-watchlist-actions">
                <select class="watchlist-status-select" onchange={{action "updateWatchlist" value="target.value" }}>
                    <option value="">Add to Watchlist...</option>
                    <option value="planned" selected={{eq this.model.watchlist_status "planned" }}>Plan to Watch
                    </option>
                    <option value="watching" selected={{eq this.model.watchlist_status "watching" }}>Watching</option>
                    <option value="completed" selected={{eq this.model.watchlist_status "completed" }}>Completed
                    </option>
                </select>
                {{#if this.model.watchlist_status}}
                <span class="current-status-badge {{this.model.watchlist_status}}">
                    {{capitalize this.model.watchlist_status}}
                </span>
                {{/if}}
            </div>
            {{/if}}
        </div>
    </div>

    <div class="anime-synopsis">
        <h2>Synopsis</h2>
        <p>{{this.model.synopsis}}</p>
    </div>

    {{#if this.model.trailer.embed_url}}
    <div class="anime-trailer">
        <h2>Trailer</h2>
        <iframe src={{this.model.trailer.embed_url}} width="100%" height="500" frameborder="0" allowfullscreen></iframe>
    </div>
    {{/if}}

    <div class="anime-discussion-section">
        <h2>Discussions</h2>
        {{#if this.model.topics}}
        <div class="existing-topics-list">
            {{#each this.model.topics as |topic|}}
            <div class="anime-topic-item">
                <a href="/t/{{topic.slug}}/{{topic.id}}" class="topic-title">
                    {{d-icon "comments"}} {{topic.title}}
                </a>
                <span class="topic-meta">
                    {{topic.post_count}} posts â€¢ Last active {{format-date topic.last_posted_at}}
                </span>
            </div>
            {{/each}}
        </div>

        <div class="more-discussions">
            <h3>Start another discussion</h3>
            {{#if this.currentUser}}
            <div class="discussion-buttons">
                <button type="button" class="btn btn-default" {{on "click" (fn this.createDiscussion "general" )}}>
                    {{d-icon "plus"}} General Discussion
                </button>
                <button type="button" class="btn btn-default" {{on "click" (fn this.createDiscussion "episodes" )}}>
                    {{d-icon "plus"}} New Episodes
                </button>
            </div>
            {{else}}
            <p class="login-prompt">Please <a href="/login">log in</a> to start a new discussion.</p>
            {{/if}}
        </div>
        {{else}}
        <div class="no-comments">
            <p>No discussion started yet for this anime.</p>
            {{#if this.currentUser}}
            <div class="discussion-buttons">
                <button type="button" class="btn btn-primary" {{on "click" (fn this.createDiscussion "general" )}}>
                    {{d-icon "plus"}} Start Main Discussion
                </button>
                <button type="button" class="btn btn-default" {{on "click" (fn this.createDiscussion "episodes" )}}>
                    {{d-icon "plus"}} Discuss Episodes
                </button>
            </div>
            {{else}}
            <p class="login-prompt">Please <a href="/login">log in</a> to start the first discussion!</p>
            {{/if}}
        </div>
        {{/if}}
    </div>
</div>